!function(){var t={757:function(t,e,n){t.exports=n(727)},727:function(t){var e=function(t){"use strict";var e,n=Object.prototype,i=n.hasOwnProperty,r="function"===typeof Symbol?Symbol:{},s=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(A){u=function(t,e,n){return t[e]=n}}function h(t,e,n,i){var r=e&&e.prototype instanceof d?e:d,s=Object.create(r.prototype),o=new I(i||[]);return s._invoke=function(t,e,n){var i=l;return function(r,s){if(i===p)throw new Error("Generator is already running");if(i===v){if("throw"===r)throw s;return w()}for(n.method=r,n.arg=s;;){var o=n.delegate;if(o){var a=N(o,n);if(a){if(a===k)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===l)throw i=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var u=c(t,e,n);if("normal"===u.type){if(i=n.done?v:f,u.arg===k)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=v,n.method="throw",n.arg=u.arg)}}}(t,n,o),s}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(A){return{type:"throw",arg:A}}}t.wrap=h;var l="suspendedStart",f="suspendedYield",p="executing",v="completed",k={};function d(){}function m(){}function T(){}var y={};u(y,s,(function(){return this}));var g=Object.getPrototypeOf,E=g&&g(g(R([])));E&&E!==n&&i.call(E,s)&&(y=E);var x=T.prototype=d.prototype=Object.create(y);function b(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function n(r,s,o,a){var u=c(t[r],t,s);if("throw"!==u.type){var h=u.arg,l=h.value;return l&&"object"===typeof l&&i.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,o,a)}),(function(t){n("throw",t,o,a)})):e.resolve(l).then((function(t){h.value=t,o(h)}),(function(t){return n("throw",t,o,a)}))}a(u.arg)}var r;this._invoke=function(t,i){function s(){return new e((function(e,r){n(t,i,e,r)}))}return r=r?r.then(s,s):s()}}function N(t,n){var i=t.iterator[n.method];if(i===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,N(t,n),"throw"===n.method))return k;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return k}var r=c(i,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,k;var s=r.arg;return s?s.done?(n[t.resultName]=s.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,k):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,k)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function L(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function R(t){if(t){var n=t[s];if(n)return n.call(t);if("function"===typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}return{next:w}}function w(){return{value:e,done:!0}}return m.prototype=T,u(x,"constructor",T),u(T,"constructor",m),m.displayName=u(T,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"===typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,T):(t.__proto__=T,u(t,a,"GeneratorFunction")),t.prototype=Object.create(x),t},t.awrap=function(t){return{__await:t}},b(S.prototype),u(S.prototype,o,(function(){return this})),t.AsyncIterator=S,t.async=function(e,n,i,r,s){void 0===s&&(s=Promise);var o=new S(h(e,n,i,r),s);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},b(x),u(x,a,"Generator"),u(x,s,(function(){return this})),u(x,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=R,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(i,r){return a.type="throw",a.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=i.call(o,"catchLoc"),h=i.call(o,"finallyLoc");if(u&&h){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,k):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),k},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),L(n),k}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;L(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:R(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),k}},t}(t.exports);try{regeneratorRuntime=e}catch(n){"object"===typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var s=e[i]={exports:{}};return t[i](s,s.exports,n),s.exports}n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,{a:e}),e},n.d=function(t,e){for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},function(){"use strict";function t(t,e,n,i,r,s,o){try{var a=t[s](o),u=a.value}catch(h){return void n(h)}a.done?e(u):Promise.resolve(u).then(i,r)}function e(e){return function(){var n=this,i=arguments;return new Promise((function(r,s){var o=e.apply(n,i);function a(e){t(o,r,s,a,u,"next",e)}function u(e){t(o,r,s,a,u,"throw",e)}a(void 0)}))}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function r(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function s(t,e){if(t){if("string"===typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}function o(t){return function(t){if(Array.isArray(t))return i(t)}(t)||r(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t){if(Array.isArray(t))return t}function u(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(t,e){return a(t)||function(t,e){var n=null==t?null:"undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,s=[],o=!0,a=!1;try{for(n=n.call(t);!(o=(i=n.next()).done)&&(s.push(i.value),!e||s.length!==e);o=!0);}catch(u){a=!0,r=u}finally{try{o||null==n.return||n.return()}finally{if(a)throw r}}return s}}(t,e)||s(t,e)||u()}var c=n(757),l=n.n(c);function f(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function p(t,e){return p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},p(t,e)}function v(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function k(t,e,n){return k=v()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&p(r,n.prototype),r},k.apply(null,arguments)}var d=Symbol("Comlink.proxy"),m=Symbol("Comlink.endpoint"),T=Symbol("Comlink.releaseProxy"),y=Symbol("Comlink.thrown"),g=function(t){return"object"===typeof t&&null!==t||"function"===typeof t},E=new Map([["proxy",{canHandle:function(t){return g(t)&&t[d]},serialize:function(t){var e=new MessageChannel,n=e.port1,i=e.port2;return x(t,n),[i,[i]]},deserialize:function(t){return t.start(),N(t,[],e);var e}}],["throw",{canHandle:function(t){return g(t)&&y in t},serialize:function(t){var e=t.value;return[e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[]]},deserialize:function(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function x(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:self;e.addEventListener("message",(function n(i){if(i&&i.data){var r,s=Object.assign({path:[]},i.data),a=s.id,u=s.type,c=s.path,l=(i.data.argumentList||[]).map(A);try{var p=c.slice(0,-1).reduce((function(t,e){return t[e]}),t),v=c.reduce((function(t,e){return t[e]}),t);switch(u){case"GET":r=v;break;case"SET":p[c.slice(-1)[0]]=A(i.data.value),r=!0;break;case"APPLY":r=v.apply(p,l);break;case"CONSTRUCT":var d;r=R(k(v,o(l)));break;case"ENDPOINT":var m=new MessageChannel,T=m.port1,g=m.port2;x(t,g),r=I(T,[T]);break;case"RELEASE":r=void 0;break;default:return}}catch(d){r=f({value:d},y,0)}Promise.resolve(r).catch((function(t){return f({value:t},y,0)})).then((function(t){var i=h(w(t),2),r=i[0],s=i[1];e.postMessage(Object.assign(Object.assign({},r),{id:a}),s),"RELEASE"===u&&(e.removeEventListener("message",n),b(e))}))}})),e.start&&e.start()}function b(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function S(t){if(t)throw new Error("Proxy has been released and is not useable")}function N(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=!1,r=new Proxy(n,{get:function(n,s){if(S(i),s===T)return function(){return P(t,{type:"RELEASE",path:e.map((function(t){return t.toString()}))}).then((function(){b(t),i=!0}))};if("then"===s){if(0===e.length)return{then:function(){return r}};var a=P(t,{type:"GET",path:e.map((function(t){return t.toString()}))}).then(A);return a.then.bind(a)}return N(t,[].concat(o(e),[s]))},set:function(n,r,s){S(i);var a=h(w(s),2),u=a[0],c=a[1];return P(t,{type:"SET",path:[].concat(o(e),[r]).map((function(t){return t.toString()})),value:u},c).then(A)},apply:function(n,r,s){S(i);var o=e[e.length-1];if(o===m)return P(t,{type:"ENDPOINT"}).then(A);if("bind"===o)return N(t,e.slice(0,-1));var a=h(O(s),2),u=a[0],c=a[1];return P(t,{type:"APPLY",path:e.map((function(t){return t.toString()})),argumentList:u},c).then(A)},construct:function(n,r){S(i);var s=h(O(r),2),o=s[0],a=s[1];return P(t,{type:"CONSTRUCT",path:e.map((function(t){return t.toString()})),argumentList:o},a).then(A)}});return r}function O(t){var e,n=t.map(w);return[n.map((function(t){return t[0]})),(e=n.map((function(t){return t[1]})),Array.prototype.concat.apply([],e))]}var L=new WeakMap;function I(t,e){return L.set(t,e),t}function R(t){return Object.assign(t,f({},d,!0))}function w(t){var e,n=function(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=s(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw o}}}}(E);try{for(n.s();!(e=n.n()).done;){var i=h(e.value,2),r=i[0],o=i[1];if(o.canHandle(t)){var a=h(o.serialize(t),2);return[{type:"HANDLER",name:r,value:a[0]},a[1]]}}}catch(u){n.e(u)}finally{n.f()}return[{type:"RAW",value:t},L.get(t)||[]]}function A(t){switch(t.type){case"HANDLER":return E.get(t.name).deserialize(t.value);case"RAW":return t.value}}function P(t,e,n){return new Promise((function(i){var r=new Array(4).fill(0).map((function(){return Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)})).join("-");t.addEventListener("message",(function e(n){n.data&&n.data.id&&n.data.id===r&&(t.removeEventListener("message",e),i(n.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:r},e),n)}))}function G(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function D(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function C(t,e,n){return e&&D(t.prototype,e),n&&D(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var M,F,U=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;G(this,t),this.store=void 0,this.outer=void 0,this.store=new Map,this.outer=e}return C(t,[{key:"get",value:function(t){var e=this.store.get(t);return void 0===e&&null!==this.outer?this.outer.get(t):e}},{key:"set",value:function(t,e){this.store.set(t,e)}},{key:"clear",value:function(){this.store.clear()}},{key:"debug",value:function(){this.store.forEach((function(t,e){console.log('"'.concat(e,'": "').concat(t,'"'))}))}}]),t}();!function(t){t.ILLEGAL="ILLEGAL",t.EOF="EOF",t.IDENT="IDENT",t.INT="INT",t.FLOAT="FLOAT",t.STRING="STRING",t.ASSIGN="=",t.PLUS="+",t.MINUS="-",t.ASTERISK="*",t.SLASH="/",t.EXP="^",t.LT="<",t.GT=">",t.LTE="<=",t.GTE=">=",t.NOT_EQ="<>",t.COLON=":",t.COMMA=",",t.SEMICOLON=";",t.LPAREN="(",t.RPAREN=")",t.AND="AND",t.BOX="BOX",t.CLR="CLR",t.CONT="CONT",t.DATA="DATA",t.DEF="DEF",t.DIM="DIM",t.DRAW="DRAW",t.ELSE="ELSE",t.END="END",t.FN="FN",t.FOR="FOR",t.GO="GO",t.GOSUB="GOSUB",t.GOTO="GOTO",t.GRAPHICS="GRAPHICS",t.IF="IF",t.INPUT="INPUT",t.LET="LET",t.LIST="LIST",t.LOAD="LOAD",t.MOD="MOD",t.NEXT="NEXT",t.NEW="NEW",t.NOT="NOT",t.ON="ON",t.OR="OR",t.PRINT="PRINT",t.READ="READ",t.REM="REM",t.RESTORE="RESTORE",t.RETURN="RETURN",t.RUN="RUN",t.SAVE="SAVE",t.STEP="STEP",t.STOP="STOP",t.THEN="THEN",t.TO="TO"}(M||(M={})),function(t){t.NUMBER="NUMBER",t.STRING="STRING",t.OPERATOR="OPERATOR",t.IDENT="IDENT",t.STATEMENT="STATEMENT",t.COMMENT="COMMENT",t.OTHER="OTHER"}(F||(F={}));var B,_,J={AND:M.AND,BOX:M.BOX,CLR:M.CLR,CONT:M.CONT,DATA:M.DATA,DEF:M.DEF,DIM:M.DIM,DRAW:M.DRAW,ELSE:M.ELSE,END:M.END,FN:M.FN,FOR:M.FOR,GO:M.GO,GOSUB:M.GOSUB,GOTO:M.GOTO,GRAPHICS:M.GRAPHICS,IF:M.IF,INPUT:M.INPUT,LET:M.LET,LIST:M.LIST,LOAD:M.LOAD,MOD:M.MOD,NEXT:M.NEXT,NEW:M.NEW,NOT:M.NOT,ON:M.ON,OR:M.OR,PRINT:M.PRINT,READ:M.READ,REM:M.REM,RESTORE:M.RESTORE,RETURN:M.RETURN,RUN:M.RUN,SAVE:M.SAVE,STEP:M.STEP,STOP:M.STOP,THEN:M.THEN,TO:M.TO};function W(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return{type:t,category:e,literal:n,line:i,column:r,start:s,end:o}}function j(){for(var t=[],e=0;e<arguments.length;e++){var n=e<0||arguments.length<=e?void 0:arguments[e];if(n)if("number"===typeof n||"string"===typeof n)t.push(n.toString());else if(n instanceof Array)for(var i=0;i<n.length;i++)n[i]&&t.push(n[i].toString())}return t.join(" ")}!function(t){t.BOX="BOX",t.CLR="CLR",t.COMPOUND="COMPOUND",t.CONT="CONT",t.DATA="DATA",t.DEF="DEF",t.DIM="DIM",t.DRAW="DRAW",t.END="END",t.FOR="FOR",t.GOSUB="GOSUB",t.GOTO="GOTO",t.GRAPHICS="GRAPHICS",t.IF="IF",t.INPUT="INPUT",t.LET="LET",t.LIST="LIST",t.LOAD="LOAD",t.ON="ON",t.NEW="NEW",t.NEXT="NEXT",t.PRINT="PRINT",t.READ="READ",t.RESTORE="RESTORE",t.REM="REM",t.RETURN="RETURN",t.RUN="RUN",t.SAVE="SAVE",t.STOP="STOP",t.EMPTY="EMPTY"}(B||(B={})),function(t){t.FLOAT="FLOAT",t.INT="INT",t.STRING="STRING"}(_||(_={}));var H,X=function(){function t(e){switch(G(this,t),this.token=void 0,this.value=void 0,this.type=void 0,this.statement=void 0,this.token=e,this.value=e.literal,this.value[this.value.length-1]){case"%":this.type=_.INT;break;case"$":this.type=_.STRING;break;default:this.type=_.FLOAT}}return C(t,[{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return this.value}}]),t}(),V=function(){function t(e,n){G(this,t),this.token=void 0,this.value=void 0,this.statement=void 0,this.token=e,this.value=n}return C(t,[{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return this.token.literal}}]),t}(),Y=function(){function t(e,n){G(this,t),this.token=void 0,this.value=void 0,this.statement=void 0,this.token=e,this.value=n}return C(t,[{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return this.token.literal}}]),t}(),z=function(){function t(e,n){G(this,t),this.token=void 0,this.value=void 0,this.statement=void 0,this.token=e,this.value=n}return C(t,[{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return'"'.concat(this.token.literal,'"')}}]),t}(),Q=function(){function t(e){G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.RUN,this.next=null,this.token=e}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.token.literal)}}]),t}(),$=function(){function t(e,n,i){G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.GOTO,this.destination=void 0,this.destinationToken=void 0,this.next=null,this.token=e,this.destination=n,this.destinationToken=i}return C(t,[{key:"getLineNumberReferences",value:function(){return[{lineNumber:this.destination,lineNumberToken:this.destinationToken,statement:this}]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.token.literal,this.destinationToken.literal)}}]),t}(),q=function(){function t(e,n,i){G(this,t),this.token=void 0,this.operator=void 0,this.right=void 0,this.statement=void 0,this.token=e,this.operator=n,this.right=i}return C(t,[{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return"".concat("FN"===this.operator?"".concat(this.operator," "):this.operator).concat(this.right?this.right.toString():"")}}]),t}(),K=function(){function t(e,n,i,r){G(this,t),this.token=void 0,this.left=void 0,this.operator=void 0,this.right=void 0,this.statement=void 0,this.token=e,this.left=n,this.operator=i,this.right=r}return C(t,[{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return"".concat(this.left.toString()," ").concat(this.operator," ").concat(this.right?this.right.toString():"")}}]),t}(),Z=function(){function t(e,n){G(this,t),this.token=void 0,this.lineNumber=0,this.lineNumberToken=void 0,this.type=B.IF,this.next=null,this.condition=void 0,this.then=void 0,this.thenToken=void 0,this.goto=void 0,this.gotoToken=void 0,this.elseToken=void 0,this.elseGoto=void 0,this.elseGotoToken=void 0,this.elseThen=void 0,this.token=e,this.condition=n,this.condition&&(this.condition.statement=this)}return C(t,[{key:"getLineNumberReferences",value:function(){var t=[];return void 0!==this.goto&&this.gotoToken&&t.push({lineNumber:this.goto,lineNumberToken:this.gotoToken,statement:this}),void 0!==this.elseGoto&&this.elseGotoToken&&t.push({lineNumber:this.elseGoto,lineNumberToken:this.elseGotoToken,statement:this}),"number"===typeof this.then&&this.thenToken?t.push({lineNumber:this.then,lineNumberToken:this.thenToken,statement:this}):this.then&&t.push.apply(t,o(this.then.getLineNumberReferences())),this.elseThen&&t.push.apply(t,o(this.elseThen.getLineNumberReferences())),t}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){var t,e,n,i,r;return j(this.lineNumber,this.token.literal,null===(t=this.condition)||void 0===t?void 0:t.toString(),this.goto?"GOTO ".concat(null===(e=this.gotoToken)||void 0===e?void 0:e.literal):null,this.then?"THEN ".concat(this.thenToken?this.thenToken.literal:this.then):null,this.elseGoto?"".concat(null===(n=this.elseToken)||void 0===n?void 0:n.literal," ").concat(null===(i=this.elseGotoToken)||void 0===i?void 0:i.literal):null,this.elseThen?"".concat(null===(r=this.elseToken)||void 0===r?void 0:r.literal," ").concat(this.elseThen):null)}}]),t}(),tt=function(){function t(e,n,i){var r=this;G(this,t),this.token=void 0,this.names=void 0,this.value=void 0,this.lineNumber=0,this.lineNumberToken=void 0,this.next=null,this.type=B.LET,this.token=e,this.names=n,this.value=i,this.value&&(this.value.statement=this),n.forEach((function(t){t.name.statement=r,t.indices.forEach((function(t){return t.statement=r}))}))}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,"LET"===this.tokenLiteral()?"LET":"",this.names.map((function(t){return t.indices.length>0?"".concat(t.name,"(").concat(t.indices.map((function(t){return t.toString()})).join(", "),")"):t.name.toString()})).join(", "),"=",this.value?this.value.toString():"")}}]),t}(),et=function(){function t(e,n){G(this,t),this.token=void 0,this.statements=void 0,this.lineNumber=0,this.lineNumberToken=void 0,this.type=B.COMPOUND,this.next=null,this.token=e,this.statements=n}return C(t,[{key:"getLineNumberReferences",value:function(){var t=[];return this.statements.forEach((function(e){return t.push.apply(t,o(e.getLineNumberReferences()))})),t}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.statements.map((function(t){return t.toString()})).join(" : "))}}]),t}(),nt=function(){function t(e,n){var i=this;G(this,t),this.token=void 0,this.args=void 0,this.type=B.PRINT,this.lineNumber=void 0,this.lineNumberToken=void 0,this.next=null,this.token=e,this.args=n,n.forEach((function(t){return t.statement=i}))}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral(),this.args.map((function(t){return t.toString()})).join(" ; "))}}]),t}(),it=function(){function t(e,n,i){var r=this;G(this,t),this.token=void 0,this.destination=void 0,this.type=B.INPUT,this.lineNumber=void 0,this.lineNumberToken=void 0,this.next=null,this.message=void 0,this.token=e,this.destination=i,this.message=n,this.message&&(this.message.statement=this),i.forEach((function(t){return t.statement=r}))}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral(),this.message?this.message.toString()+";":null,this.destination.join(", "))}}]),t}(),rt=function(){function t(e,n,i,r,s){G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.FOR,this.next=null,this.iterator=void 0,this.from=void 0,this.to=void 0,this.step=void 0,this.token=e,this.iterator=n,this.from=i,this.to=r,this.step=s,this.iterator&&(this.iterator.statement=this),this.from&&(this.from.statement=this),this.to&&(this.to.statement=this),this.step&&(this.step.statement=this)}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"toString",value:function(){var t,e,n;return j(this.lineNumber,this.tokenLiteral(),null===(t=this.iterator)||void 0===t?void 0:t.toString(),"=",null===(e=this.from)||void 0===e?void 0:e.toString(),"TO",null===(n=this.to)||void 0===n?void 0:n.toString(),this.step&&"STEP",this.step&&this.step.toString())}},{key:"tokenLiteral",value:function(){return this.token.literal}}]),t}(),st=function(){function t(e,n){var i=this;G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.NEXT,this.next=null,this.values=void 0,this.token=e,this.values=n,n.forEach((function(t){return t.statement=i}))}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral(),this.values.map((function(t){return t.toString()})).join(", "))}},{key:"tokenLiteral",value:function(){return this.token.literal}}]),t}(),ot=function(){function t(e,n,i){G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.GOSUB,this.next=null,this.gosubLineNumber=void 0,this.gosubLineNumberToken=void 0,this.token=e,this.gosubLineNumber=n,this.gosubLineNumberToken=i}return C(t,[{key:"getLineNumberReferences",value:function(){return[{lineNumber:this.gosubLineNumber,lineNumberToken:this.gosubLineNumberToken,statement:this}]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral(),this.gosubLineNumberToken.literal)}}]),t}(),at=function(){function t(e){G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.RETURN,this.next=null,this.token=e}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral())}}]),t}(),ut=function(){function t(e){G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.REM,this.next=null,this.token=e}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral())}}]),t}(),ht=function(){function t(e,n,i){G(this,t),this.token=void 0,this.fn=void 0,this.args=void 0,this.statement=void 0,this.token=e,this.fn=n,this.args=i}return C(t,[{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return"".concat(this.fn.toString(),"(").concat(this.args.map((function(t){return t.toString()})).join(", "),")")}}]),t}(),ct=function(){function t(e,n,i){G(this,t),this.token=void 0,this.endToken=void 0,this.expression=void 0,this.statement=void 0,this.token=e,this.expression=n,this.endToken=i}return C(t,[{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return"(".concat(this.expression,")")}}]),t}(),lt=function(){function t(e){G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.CLR,this.next=null,this.token=e}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral())}}]),t}(),ft=function(){function t(e,n){var i=this;G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.DATA,this.next=null,this.datas=void 0,this.token=e,this.datas=n,this.datas.forEach((function(t){return t.statement=i}))}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral(),this.datas.map((function(t){return t.toString()})).join(", "))}}]),t}(),pt=function(){function t(e,n){var i=this;G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.READ,this.next=null,this.outputs=void 0,this.token=e,this.outputs=n,this.outputs.forEach((function(t){t.name.statement=i,t.indices.forEach((function(t){return t.statement=i}))}))}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral(),this.outputs.map((function(t){return t.indices.length>0?"".concat(t.name,"(").concat(t.indices.map((function(t){return t.toString()})).join(", "),")"):t.name.toString()})).join(", "))}}]),t}(),vt=function(){function t(e){G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.RESTORE,this.next=null,this.token=e}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral())}}]),t}(),kt=function(){function t(e,n,i,r){G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.DEF,this.next=null,this.name=void 0,this.argument=void 0,this.body=void 0,this.token=e,this.name=n,this.argument=i,this.body=r,this.name.statement=this,this.argument&&(this.argument.statement=this),this.body.statement=this}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral(),"FN","".concat(this.name.toString(),"(").concat(this.argument?this.argument.toString():"",")"),"=",this.body.toString())}}]),t}(),dt=function(){function t(e,n){var i=this;G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.DIM,this.next=null,this.variables=void 0,this.token=e,this.variables=n,n.forEach((function(t){t.name.statement=i,t.dimensions.forEach((function(t){return t.statement=i}))}))}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral(),this.variables.map((function(t){return"".concat(t.name,"(").concat(t.dimensions.map((function(t){return t.toString()})).join(", "),")")})).join(", "))}}]),t}(),mt=function(){function t(e){G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.END,this.next=null,this.token=e}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral())}}]),t}(),Tt=function(){function t(e){G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.CONT,this.next=null,this.token=e}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral())}}]),t}(),yt=function(){function t(e,n,i){G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.LIST,this.next=null,this.startLine=void 0,this.endLine=void 0,this.token=e,this.startLine=n,this.endLine=i,this.startLine&&(this.startLine.statement=this),this.endLine&&(this.endLine.statement=this)}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral())}}]),t}(),gt=function(){function t(e,n){G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.LOAD,this.next=null,this.filename=void 0,this.token=e,this.filename=n,this.filename.statement=this}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral(),this.filename.toString())}}]),t}(),Et=function(){function t(e,n){G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.SAVE,this.next=null,this.filename=void 0,this.token=e,this.filename=n,this.filename.statement=this}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral(),this.filename.toString())}}]),t}(),xt=function(){function t(e){G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.NEW,this.next=null,this.token=e}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral())}}]),t}(),bt=function(){function t(e,n,i,r){var s=this;G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.ON,this.next=null,this.condition=void 0,this.operation=void 0,this.destinations=void 0,this.token=e,this.condition=n,this.operation=i,this.destinations=r,this.condition.statement=this,this.destinations.forEach((function(t){return t.statement=s}))}return C(t,[{key:"getLineNumberReferences",value:function(){var t=this,e=[];return this.destinations.forEach((function(n){n instanceof V&&e.push({lineNumber:n.value,lineNumberToken:n.token,statement:t})})),e}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral(),this.condition.toString(),this.operation.literal,this.destinations.map((function(t){return t.toString()})).join(", "))}}]),t}(),St=function(){function t(e){G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.STOP,this.next=null,this.token=e}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral())}}]),t}(),Nt=function(){function t(e,n,i){G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.GRAPHICS,this.next=null,this.width=void 0,this.height=void 0,this.token=e,this.width=n,this.height=i}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral(),"".concat(this.width.toString(),", ").concat(this.height.toString()))}}]),t}(),Ot=function(){function t(e,n,i,r,s,o){G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.DRAW,this.next=null,this.color=void 0,this.x1=void 0,this.y1=void 0,this.x2=void 0,this.y2=void 0,this.token=e,this.color=n,this.x1=i,this.y1=r,this.x2=s,this.y2=o}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){var t,e;return j(this.lineNumber,this.tokenLiteral(),[this.color.toString(),this.x1.toString(),this.y1.toString()].join(", "),this.x2?M.TO:null,[null===(t=this.x2)||void 0===t?void 0:t.toString(),null===(e=this.y2)||void 0===e?void 0:e.toString()].filter((function(t){return t})).join(", "))}}]),t}(),Lt=function(){function t(e,n,i,r,s,o){G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.BOX,this.next=null,this.color=void 0,this.left=void 0,this.top=void 0,this.width=void 0,this.height=void 0,this.token=e,this.color=n,this.left=i,this.top=r,this.width=s,this.height=o}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber,this.tokenLiteral(),[this.color.toString(),this.left.toString(),this.top.toString(),this.width.toString(),this.height.toString()].join(", "))}}]),t}(),It=function(){function t(e){G(this,t),this.token=void 0,this.lineNumber=void 0,this.lineNumberToken=void 0,this.type=B.EMPTY,this.next=null,this.token=e}return C(t,[{key:"getLineNumberReferences",value:function(){return[]}},{key:"tokenLiteral",value:function(){return this.token.literal}},{key:"toString",value:function(){return j(this.lineNumber)}}]),t}();!function(t){t.INTEGER_OBJ="INTEGER",t.FLOAT_OBJ="FLOAT",t.RETURN_VALUE_OBJ="RETURN_VALUE",t.ERROR_OBJ="ERROR",t.STRING_OBJ="STRING",t.NULL_OBJ="NULL",t.BUILTIN_OBJ="BUILTIN",t.FUNCTION_OBJ="FUNCTION",t.ARRAY_OBJ="ARRAY",t.CALCULATED_OBJ="CALCULATED"}(H||(H={}));var Rt=function(){function t(){G(this,t)}return C(t,[{key:"inspect",value:function(){return"NULL"}},{key:"type",value:function(){return H.NULL_OBJ}},{key:"toString",value:function(){return"NULL"}}]),t}(),wt=function(){function t(e){G(this,t),this.value=0,this.value=Math.floor(e)}return C(t,[{key:"inspect",value:function(){return"".concat(this.value)}},{key:"type",value:function(){return H.INTEGER_OBJ}},{key:"toString",value:function(){return"".concat(this.value)}}]),t}(),At=function(){function t(e){G(this,t),this.value=0,this.value=e}return C(t,[{key:"inspect",value:function(){return"".concat(this.value)}},{key:"type",value:function(){return H.FLOAT_OBJ}},{key:"toString",value:function(){return"".concat(this.value)}}]),t}(),Pt=function(){function t(e){G(this,t),this.value=void 0,this.value=e}return C(t,[{key:"inspect",value:function(){return'"'.concat(this.value,'"')}},{key:"type",value:function(){return H.STRING_OBJ}},{key:"toString",value:function(){return this.value}}]),t}(),Gt=function(){function t(e){G(this,t),this.message=void 0,this.line=void 0,this.message=e}return C(t,[{key:"inspect",value:function(){return"ERROR: ".concat(this.message)}},{key:"type",value:function(){return H.ERROR_OBJ}},{key:"toString",value:function(){return this.line?"LINE: ".concat(this.line,"\nERROR: ").concat(this.message):"ERROR: ".concat(this.message)}}]),t}(),Dt=function(){function t(e){G(this,t),this.fn=void 0,this.fn=e}return C(t,[{key:"type",value:function(){return H.BUILTIN_OBJ}},{key:"inspect",value:function(){return"builtin function"}}]),t}(),Ct=function(){function t(e,n){G(this,t),this.argument=void 0,this.body=void 0,this.argument=e,this.body=n}return C(t,[{key:"inspect",value:function(){return"FN(".concat(this.argument?this.argument.toString():"",") = ").concat(this.body.toString())}},{key:"type",value:function(){return H.FUNCTION_OBJ}},{key:"toString",value:function(){return"FN(".concat(this.argument?this.argument.toString():"",") = ").concat(this.body.toString())}}]),t}(),Mt=function(){function t(e,n){G(this,t),this.dimensions=void 0,this.data=void 0,this.identifierType=void 0,this.identifierType=e;var i,o,h=a(i=n)||r(i)||s(i)||u(),c=h[0],l=h.slice(1).reduce((function(t,e){return t*e}),c);this.data=new Array(l),this.dimensions=n,o=e===_.INT?new wt(0):e===_.FLOAT?new At(0):e===_.STRING?new Pt(""):new wt(0);for(var f=0;f<l;f++)this.data[f]=o}return C(t,[{key:"calculateIndex",value:function(t){if(t.length!==this.dimensions.length)return new Gt("not enough indices");for(var e=0,n=0;n<t.length-1;n++){if(t[n]<0||t[n]>this.dimensions[n])return new Gt("array index out of bounds, ".concat(t[n]));for(var i=Math.floor(t[n]),r=n+1;r<this.dimensions.length;r++)i*=this.dimensions[r];e+=i}return t[t.length-1]<0||t[t.length-1]>this.dimensions[t.length-1]?new Gt("array index out of bounds, ".concat(t[t.length-1])):e+=Math.floor(t[t.length-1])}},{key:"get",value:function(t){var e=this.calculateIndex(t);return"number"!==typeof e?e:this.data[e]}},{key:"set",value:function(t,e){var n=this.calculateIndex(t);return"number"!==typeof n?n:(this.identifierType===_.INT||this.identifierType===_.FLOAT)&&(e.type()===H.INTEGER_OBJ||e.type()===H.FLOAT_OBJ)||this.identifierType===_.STRING&&e.type()===H.STRING_OBJ?(this.data[n]=e,e):new Gt("type mismatch")}},{key:"inspect",value:function(){return"[".concat(this.data.map((function(t){return t.inspect()})).join(", "),"]")}},{key:"type",value:function(){return H.ARRAY_OBJ}},{key:"toString",value:function(){return"ARRAY(".concat(this.dimensions.join(", "),")")}}]),t}(),Ft=function(){function t(e){G(this,t),this.calculator=void 0,this.calculator=e}return C(t,[{key:"getValue",value:function(){return this.calculator()}},{key:"inspect",value:function(){return"".concat(this.calculator())}},{key:"type",value:function(){return H.CALCULATED_OBJ}},{key:"toString",value:function(){return"[CALCULATED VALUE]"}}]),t}();function Ut(t){return t.type()===H.ERROR_OBJ}function Bt(t){return t.type()===H.FLOAT_OBJ||t.type()===H.INTEGER_OBJ}function _t(t){return t.type()===H.STRING_OBJ}function Jt(t){if(0===t.length)return new Gt("too few arguments");if(t.length>1)return new Gt("expected single argument");var e=t[0];return e.type()!==H.STRING_OBJ?new Gt("type mismatch, expected ".concat(H.STRING_OBJ,", received ").concat(e.type())):e}function Wt(t){return new Dt((function(e){var n=function(t){if(0===t.length)return new Gt("too few arguments");if(t.length>1)return new Gt("expected single argument");var e=t[0];return e.type()!==H.INTEGER_OBJ&&e.type()!==H.FLOAT_OBJ?new Gt("type mismatch, expected ".concat(H.FLOAT_OBJ,", received ").concat(e.type())):e}(e);if(Ut(n))return n;var i=t(n.value);return"number"===typeof i?isNaN(i)?new Gt("ILLEGAL QUANTITY"):new At(i):i}))}var jt={ABS:Wt(Math.abs),ASC:new Dt((function(t){var e=Jt(t);return Ut(e)?e:new wt(e.value.charCodeAt(0))})),ATN:Wt(Math.atan),CHR$:Wt((function(t){return new Pt(String.fromCharCode(t))})),COS:Wt(Math.cos),EXP:Wt(Math.exp),INT:Wt((function(t){return new wt(t)})),LEFT$:new Dt((function(t){if(2!==t.length)return new Gt("expected 2 arguments");var e=t[0],n=t[1];return _t(e)?Bt(n)?n.value<0?new Gt("illegal quantity error, ".concat(n.type())):0===n.value?new Pt(""):n.value>=e.value.length?e:new Pt(e.value.substr(0,n.value)):new Gt("type mismatch, expected number got ".concat(n.type())):new Gt("type mismatch, expected string got ".concat(e.type()))})),LEN:new Dt((function(t){var e=Jt(t);return Ut(e)?e:new wt(e.value.length)})),LOG:Wt(Math.log),MID$:new Dt((function(t){if(t.length<2||t.length>=4)return new Gt("expected 2 or 3 arguments");var e=t[0],n=t[1];if(!_t(e))return new Gt("type mismatch, expected string got ".concat(e.type()));var i=e.value.length;if(3===t.length){if(!Bt(t[2]))return new Gt("type mismatch, expected number got ".concat(t[2].type()));i=t[2].value}return Bt(n)?n.value<0?new Gt("illegal quantity error, ".concat(n.type())):0===n.value?new Pt(""):n.value>=e.value.length||i<=0?e:new Pt(e.value.substr(n.value-1,i)):new Gt("type mismatch, expected number got ".concat(n.type()))})),RGB:new Dt((function(t){if(3!==t.length)return new Gt("expected 3 arguments");var e=t[0],n=t[1],i=t[2];if(!Bt(e))return new Gt("expected red to be numeric");if(!Bt(n))return new Gt("expected green to be numeric");if(!Bt(i))return new Gt("expected blue to be numeric");function r(t){var e=t.toString(16);return 1===e.length?"0".concat(e):e}return new Pt(r(e.value)+r(n.value)+r(i.value)+"FF")})),RIGHT$:new Dt((function(t){if(2!==t.length)return new Gt("expected 2 arguments");var e=t[0],n=t[1];return _t(e)?Bt(n)?n.value<0?new Gt("illegal quantity error, ".concat(n.type())):0===n.value?new Pt(""):n.value>=e.value.length?e:new Pt(e.value.substr(e.value.length-n.value)):new Gt("type mismatch, expected number got ".concat(n.type())):new Gt("type mismatch, expected string got ".concat(e.type()))})),RND:new Dt((function(){return new At(Math.random())})),SGN:Wt((function(t){return t<0?-1:t>0?1:0})),SIN:Wt(Math.sin),SPC:Wt((function(t){return new Pt(" ".repeat(t))})),SQR:Wt(Math.sqrt),STR$:Wt((function(t){return new Pt("".concat(t))})),TAN:Wt(Math.tan),VAL:new Dt((function(t){var e=Jt(t);return Ut(e)?e:new At(parseFloat(e.value))}))};function Ht(t){return""!==t&&"abcdefghijklmnopqrstuvwxyz_".indexOf(t.toLowerCase())>=0}function Xt(t){return""!==t&&"0123456789".indexOf(t.toLowerCase())>=0}var Vt,Yt,zt=function(){function t(e){G(this,t),this.input=void 0,this.position=void 0,this.readPosition=void 0,this.ch=void 0,this.line=void 0,this.column=void 0,this.input=e,this.position=0,this.readPosition=0,this.ch="",this.line=1,this.column=0,this.readChar()}return C(t,[{key:"peekChar",value:function(){return this.readPosition>=this.input.length?"":this.input[this.readPosition]}},{key:"readChar",value:function(){this.readPosition>=this.input.length?this.ch="":("\n"===this.ch?(this.line++,this.column=1):this.column++,this.ch=this.input[this.readPosition]),this.position=this.readPosition,this.readPosition++}},{key:"readIdentifier",value:function(){for(var t=this.position;Ht(this.ch);)this.readChar();for(;Ht(this.ch)||Xt(this.ch);)this.readChar();return"$"!==this.ch&&"%"!==this.ch||this.readChar(),this.input.slice(t,this.position).toUpperCase()}},{key:"readNumber",value:function(){for(var t=this.position;Xt(this.ch)||"."===this.ch;)this.readChar();return this.input.slice(t,this.position)}},{key:"skipWhitespace",value:function(){for(;" "===this.ch||"\t"===this.ch||"\r"===this.ch||"\n"===this.ch;)this.readChar()}},{key:"readString",value:function(){for(var t=this.position+1;this.readChar(),'"'!==this.ch&&""!==this.ch;);return this.input.substr(t,this.position-t)}},{key:"nextToken",value:function(){var t;switch(this.skipWhitespace(),this.ch){case"=":t=W(M.ASSIGN,F.OPERATOR,this.ch,this.line,this.column,this.position,this.position);break;case":":t=W(M.COLON,F.OPERATOR,this.ch,this.line,this.column,this.position,this.position);break;case",":t=W(M.COMMA,F.OTHER,this.ch,this.line,this.column,this.position,this.position);break;case"(":t=W(M.LPAREN,F.OTHER,this.ch,this.line,this.column,this.position,this.position);break;case")":t=W(M.RPAREN,F.OTHER,this.ch,this.line,this.column,this.position,this.position);break;case"+":t=W(M.PLUS,F.OPERATOR,this.ch,this.line,this.column,this.position,this.position);break;case"-":t=W(M.MINUS,F.OPERATOR,this.ch,this.line,this.column,this.position,this.position);break;case"*":t=W(M.ASTERISK,F.OPERATOR,this.ch,this.line,this.column,this.position,this.position);break;case"/":t=W(M.SLASH,F.OPERATOR,this.ch,this.line,this.column,this.position,this.position);break;case"<":"="===this.peekChar()?(t=W(M.LTE,F.OPERATOR,"<=",this.line,this.column,this.position-1,this.position),this.readChar()):">"===this.peekChar()?(t=W(M.NOT_EQ,F.OPERATOR,"<>",this.line,this.column,this.position-1,this.position),this.readChar()):t=W(M.LT,F.OPERATOR,this.ch,this.line,this.column,this.position,this.position);break;case">":"="===this.peekChar()?(t=W(M.GTE,F.OPERATOR,this.ch,this.line,this.column,this.position-1,this.position),this.readChar()):t=W(M.GT,F.OPERATOR,this.ch,this.line,this.column,this.position,this.position);break;case"":t=W(M.EOF,F.OTHER,this.ch,this.line,this.column,this.position,this.position);break;case'"':var e=this.line,n=this.column,i=this.position;t=W(M.STRING,F.STRING,this.readString(),e,n,i,this.position);break;case"^":t=W(M.EXP,F.OPERATOR,this.ch,this.line,this.column,this.position,this.position);break;case"?":t=W(M.PRINT,F.STATEMENT,this.ch,this.line,this.column,this.position,this.position);break;case";":t=W(M.SEMICOLON,F.OTHER,this.ch,this.line,this.column,this.position,this.position);break;default:if(Ht(this.ch)){var r=this.line,s=this.column,o=this.position,a=this.readIdentifier(),u=function(t){var e;return null!==(e=J[t.toUpperCase()])&&void 0!==e?e:M.IDENT}(a);if((t=W(u,u===M.IDENT?F.IDENT:F.STATEMENT,a,r,s,o,this.position)).type===M.REM){for(var h="";"\n"!==this.ch&&""!==this.ch;)h+=this.ch,this.readChar();t.literal="REM"+h,t.category=F.COMMENT,t.end=this.position}return t}if(Xt(this.ch)||"."===this.ch){var c=this.line,l=this.column,f=this.position,p=this.readNumber();return t=W(p.indexOf(".")>=0?M.FLOAT:M.INT,F.NUMBER,p,c,l,f,this.position)}t=W(M.ILLEGAL,F.OTHER,this.ch,this.line,this.column,this.position,this.position)}return this.readChar(),t}}]),t}();!function(t){t[t.LOWEST=0]="LOWEST",t[t.LOGICAL=1]="LOGICAL",t[t.EQUALS=2]="EQUALS",t[t.LESSGREATER=3]="LESSGREATER",t[t.SUM=4]="SUM",t[t.PRODUCT=5]="PRODUCT",t[t.PREFIX=6]="PREFIX",t[t.CALL=7]="CALL",t[t.INDEX=8]="INDEX"}(Yt||(Yt={}));var Qt,$t=(f(Vt={},M.ASSIGN,Yt.EQUALS),f(Vt,M.NOT_EQ,Yt.EQUALS),f(Vt,M.LT,Yt.LESSGREATER),f(Vt,M.GT,Yt.LESSGREATER),f(Vt,M.LTE,Yt.LESSGREATER),f(Vt,M.GTE,Yt.LESSGREATER),f(Vt,M.PLUS,Yt.SUM),f(Vt,M.MINUS,Yt.SUM),f(Vt,M.ASTERISK,Yt.PRODUCT),f(Vt,M.SLASH,Yt.PRODUCT),f(Vt,M.EXP,Yt.PRODUCT),f(Vt,M.AND,Yt.LOGICAL),f(Vt,M.OR,Yt.LOGICAL),f(Vt,M.NOT,Yt.LOGICAL),f(Vt,M.LPAREN,Yt.CALL),f(Vt,M.MOD,Yt.PRODUCT),Vt),qt=function(){function t(e){G(this,t),this.lexer=void 0,this.errors=void 0,this.curToken=void 0,this.peekToken=void 0,this.prefixParsers=void 0,this.infixParsers=void 0,this.lexer=e,this.errors=[],this.prefixParsers={},this.infixParsers={},this.registerPrefix(M.IDENT,this.parseIdentifier.bind(this)),this.registerPrefix(M.INT,this.parseIntegerLiteral.bind(this)),this.registerPrefix(M.FLOAT,this.parseFloatLiteral.bind(this)),this.registerPrefix(M.STRING,this.parseStringLiteral.bind(this)),this.registerPrefix(M.MINUS,this.parsePrefixExpression.bind(this)),this.registerPrefix(M.LPAREN,this.parseGroupedExpression.bind(this)),this.registerPrefix(M.NOT,this.parsePrefixExpression.bind(this)),this.registerPrefix(M.FN,this.parsePrefixExpression.bind(this)),this.registerInfix(M.PLUS,this.parseInfixExpression.bind(this)),this.registerInfix(M.MOD,this.parseInfixExpression.bind(this)),this.registerInfix(M.MINUS,this.parseInfixExpression.bind(this)),this.registerInfix(M.SLASH,this.parseInfixExpression.bind(this)),this.registerInfix(M.ASTERISK,this.parseInfixExpression.bind(this)),this.registerInfix(M.EXP,this.parseInfixExpression.bind(this)),this.registerInfix(M.ASSIGN,this.parseInfixExpression.bind(this)),this.registerInfix(M.NOT_EQ,this.parseInfixExpression.bind(this)),this.registerInfix(M.LT,this.parseInfixExpression.bind(this)),this.registerInfix(M.GT,this.parseInfixExpression.bind(this)),this.registerInfix(M.LTE,this.parseInfixExpression.bind(this)),this.registerInfix(M.GTE,this.parseInfixExpression.bind(this)),this.registerInfix(M.AND,this.parseInfixExpression.bind(this)),this.registerInfix(M.OR,this.parseInfixExpression.bind(this)),this.registerInfix(M.LPAREN,this.parseCallExpression.bind(this)),this.nextToken(),this.nextToken()}return C(t,[{key:"pushError",value:function(t){this.errors.push("Column ".concat(this.curToken.column," - ").concat(t))}},{key:"registerPrefix",value:function(t,e){this.prefixParsers[t]=e}},{key:"registerInfix",value:function(t,e){this.infixParsers[t]=e}},{key:"nextToken",value:function(){this.curToken=this.peekToken,this.peekToken=this.lexer.nextToken()}},{key:"peekTokenIs",value:function(t){return this.peekToken.type===t}},{key:"curTokenIs",value:function(t){return this.curToken.type===t}},{key:"peekError",value:function(t){this.pushError("expected next token to be ".concat(t,", got ").concat(this.peekToken.type," instead"))}},{key:"noPrefixParseFnError",value:function(t){this.pushError("no prefix parse function available for ".concat(t))}},{key:"expectPeek",value:function(t){return this.peekTokenIs(t)?(this.nextToken(),!0):(this.peekError(t),!1)}},{key:"peekPrecedence",value:function(){var t=$t[this.peekToken.type];return void 0!==t?t:Yt.LOWEST}},{key:"curPrecedence",value:function(){var t=$t[this.curToken.type];return void 0!==t?t:Yt.LOWEST}},{key:"parseStatement",value:function(){var t=void 0,e=void 0;this.curToken.type===M.INT&&(e=this.curToken,t=parseInt(this.curToken.literal,10),this.nextToken());for(var n=this.curToken,i=[];;){switch(this.curToken.type){case M.LET:i.push(this.parseLetStatement());break;case M.PRINT:i.push(this.parsePrintStatement());break;case M.RUN:i.push(new Q(this.curToken));break;case M.INPUT:i.push(this.parseInputStatement());break;case M.GOTO:i.push(this.parseGotoStatement());break;case M.IF:i.push(this.parseIfStatement());break;case M.FOR:i.push(this.parseForStatement());break;case M.NEXT:i.push(this.parseNextStatement());break;case M.REM:i.push(new ut(this.curToken));break;case M.RETURN:i.push(new at(this.curToken));break;case M.GOSUB:i.push(this.parseGosubStatement());break;case M.CLR:i.push(new lt(this.curToken));break;case M.DATA:i.push(this.parseDataStatement());break;case M.READ:i.push(this.parseReadStatement());break;case M.RESTORE:i.push(new vt(this.curToken));break;case M.DEF:i.push(this.parseDefStatement());break;case M.DIM:i.push(this.parseDimStatement());break;case M.END:i.push(new mt(this.curToken));break;case M.CONT:i.push(new Tt(this.curToken));break;case M.LIST:i.push(this.parseListStatement());break;case M.LOAD:i.push(this.parseLoadStatement());break;case M.SAVE:i.push(this.parseSaveStatement());break;case M.NEW:i.push(new xt(this.curToken));break;case M.ON:i.push(this.parseOnStatement());break;case M.STOP:i.push(new St(this.curToken));break;case M.GRAPHICS:i.push(this.parseGraphicsStatement());break;case M.DRAW:i.push(this.parseDrawStatement());break;case M.BOX:i.push(this.parseBoxStatement());break;case M.EOF:i.push(new It(this.curToken));break;default:i.push(this.parseLetStatement())}if(this.nextToken(),!this.curTokenIs(M.COLON)){if(this.curTokenIs(M.EOF))break;this.pushError("unexpected token "+this.curToken.type+". expected end of line or compound statement");break}this.nextToken()}var r=i.length>1?new et(n,i.filter((function(t){return null!==t}))):i[0];return r&&(r.lineNumber=t,r.lineNumberToken=e),r}},{key:"parseLetStatement",value:function(){var t=this,e=this.curToken;if(this.curTokenIs(M.LET)&&this.nextToken(),!this.curTokenIs(M.IDENT))return this.pushError("Expecting identifier but found ".concat(this.curToken.type)),null;var n=function(){var e=t.parseIdentifier();return e?t.peekTokenIs(M.LPAREN)?(t.nextToken(),{name:e,indices:t.parseExpressionList(M.RPAREN)}):{name:e,indices:[]}:null},i=[],r=n();for(r&&i.push(r);this.peekTokenIs(M.COMMA);){this.nextToken(),this.nextToken();var s=n();s&&i.push(s)}if(!this.expectPeek(M.ASSIGN))return null;this.nextToken();var o=this.parseExpression(Yt.LOWEST);return new tt(e,i,o)}},{key:"parsePrintStatement",value:function(){for(var t=this.curToken,e=[];!this.peekTokenIs(M.COLON)&&!this.peekTokenIs(M.EOF)&&!this.peekTokenIs(M.ELSE);)this.peekTokenIs(M.COMMA)||this.peekTokenIs(M.SEMICOLON)?this.nextToken():(this.nextToken(),e.push(this.parseExpression(Yt.LOWEST)));return new nt(t,e.filter((function(t){return t})))}},{key:"parseInputStatement",value:function(){var t=this.curToken,e=null,n=[];if(this.peekTokenIs(M.STRING)&&(this.nextToken(),e=this.parseStringLiteral(),!this.expectPeek(M.SEMICOLON)))return null;if(!this.peekTokenIs(M.IDENT))return this.pushError("expected identifier"),null;for(this.nextToken(),n.push(this.parseIdentifier());this.peekTokenIs(M.COMMA);)this.nextToken(),this.nextToken(),n.push(this.parseIdentifier());return new it(t,e,n)}},{key:"parseExpression",value:function(t){var e=this.prefixParsers[this.curToken.type];if(!e)return this.noPrefixParseFnError(this.curToken.type),null;for(var n=e();t<this.peekPrecedence();){var i=this.infixParsers[this.peekToken.type];if(!i)return n;this.nextToken(),n=i(n)}return n}},{key:"parseIdentifier",value:function(){return new X(this.curToken)}},{key:"parseIntegerLiteral",value:function(){var t=parseInt(this.curToken.literal,10);return isNaN(t)?(this.pushError('could not parse "'.concat(this.curToken.literal,'" as integer')),null):new V(this.curToken,t)}},{key:"parseFloatLiteral",value:function(){var t=parseFloat(this.curToken.literal);return isNaN(t)?(this.pushError('could not parse "'.concat(this.curToken.literal,'" as float')),null):new Y(this.curToken,t)}},{key:"parseStringLiteral",value:function(){return new z(this.curToken,this.curToken.literal)}},{key:"parsePrefixExpression",value:function(){var t=this.curToken;this.nextToken();var e=this.parseExpression(t.type===M.NOT?Yt.LOGICAL:Yt.PREFIX);return new q(t,t.literal,e)}},{key:"parseInfixExpression",value:function(t){var e=this.curToken,n=this.curPrecedence();return t?(this.nextToken(),new K(e,t,e.literal,this.parseExpression(n))):null}},{key:"parseGroupedExpression",value:function(){var t=this.curToken;this.nextToken();var e=this.parseExpression(Yt.LOWEST),n=this.curToken;return this.expectPeek(M.RPAREN)?new ct(t,e,n):null}},{key:"parseGotoStatement",value:function(){var t=this.curToken;if(!this.expectPeek(M.INT))return null;var e=parseInt(this.curToken.literal,10);return isNaN(e)?(this.pushError("invalid line number ".concat(this.curToken.literal)),null):new $(t,e,this.curToken)}},{key:"parseIfStatement",value:function(){var t=this.curToken;this.nextToken();var e=this.parseExpression(Yt.LOWEST),n=new Z(t,e);if(this.peekTokenIs(M.GOTO)){if(this.nextToken(),!this.expectPeek(M.INT))return null;var i=parseInt(this.curToken.literal,10);if(isNaN(i))return this.pushError("cannot goto a number that is not a number, ".concat(this.curToken.literal)),null;n.goto=i,n.gotoToken=this.curToken,this.nextToken()}else{if(!this.peekTokenIs(M.THEN))return this.pushError("IF must be followed by GOTO or THEN, found ".concat(this.peekToken.literal)),null;if(this.nextToken(),this.peekTokenIs(M.INT)){this.nextToken();var r=parseInt(this.curToken.literal,10);if(isNaN(r))return this.pushError("cannot goto a number that is not a number, ".concat(this.curToken.literal)),null;n.then=r,n.thenToken=this.curToken,this.nextToken()}else{this.nextToken();this.curToken;var s=this.parseStatement();s&&(n.then=s)}}if(this.curTokenIs(M.ELSE))if(n.elseToken=this.curToken,this.peekTokenIs(M.INT)){this.nextToken();var o=parseInt(this.curToken.literal,10);if(isNaN(o)||o<0)return this.pushError("Invalid line number in else statement ".concat(this.curToken.literal)),null;n.elseGoto=o,n.elseGotoToken=this.curToken}else{this.nextToken();var a=this.parseStatement();if(!a)return this.pushError("ELSE without statement"),null;n.elseThen=a}return n}},{key:"parseForStatement",value:function(){var t=this.curToken;if(!this.expectPeek(M.IDENT))return null;var e=this.parseIdentifier();if(!this.expectPeek(M.ASSIGN))return null;this.nextToken();var n=this.parseExpression(Yt.LOWEST);if(!this.expectPeek(M.TO))return null;this.nextToken();var i=this.parseExpression(Yt.LOWEST),r=null;return this.peekTokenIs(M.STEP)&&(this.nextToken(),this.nextToken(),r=this.parseExpression(Yt.LOWEST)),new rt(t,e,n,i,r)}},{key:"parseNextStatement",value:function(){var t=this.curToken,e=[];if(this.peekTokenIs(M.IDENT)){this.nextToken();var n=this.parseIdentifier();for(n&&e.push(n);this.peekTokenIs(M.COMMA);){this.nextToken(),this.nextToken();var i=this.parseIdentifier();i&&e.push(i)}}return new st(t,e)}},{key:"parseGosubStatement",value:function(){var t=this.curToken;if(!this.expectPeek(M.INT))return null;var e=this.parseIntegerLiteral();return e?new ot(t,e.value,this.curToken):null}},{key:"parseCallExpression",value:function(t){return new ht(this.curToken,t,this.parseExpressionList(M.RPAREN))}},{key:"parseExpressionList",value:function(t){var e=[];if(this.peekTokenIs(t))return this.nextToken(),e;this.nextToken();var n=this.parseExpression(Yt.LOWEST);for(n&&e.push(n);this.peekTokenIs(M.COMMA);){this.nextToken(),this.nextToken();var i=this.parseExpression(Yt.LOWEST);i&&e.push(i)}return this.expectPeek(t)?e:[]}},{key:"parseDataStatement",value:function(){for(var t=this.curToken,e=[];!this.peekTokenIs(M.EOF)&&!this.peekTokenIs(M.COLON);)if(this.peekTokenIs(M.COMMA)||this.peekTokenIs(M.SEMICOLON))this.nextToken();else{this.nextToken();var n=this.parseExpression(Yt.LOWEST);if(n){if(!(n instanceof V)&&!(n instanceof Y)&&!(n instanceof z)&&!(n instanceof X)&&!(n instanceof q&&"-"===n.operator&&(n.right instanceof V||n.right instanceof Y)))return this.pushError("invalid data value, must be an number, string, or non-reserved keyword."),null;e.push(n)}}return new ft(t,e)}},{key:"parseReadStatement",value:function(){for(var t=this.curToken,e=[];!this.peekTokenIs(M.EOF)&&!this.peekTokenIs(M.COLON);){this.nextToken();var n=this.parseExpression(Yt.CALL);if(!n||!(n instanceof X))return this.pushError("can only READ into identifiers, not ".concat(n)),null;if(this.peekTokenIs(M.LPAREN)){this.nextToken();var i=this.parseExpressionList(M.RPAREN);e.push({name:n,indices:i})}else e.push({name:n,indices:[]});this.peekTokenIs(M.COMMA)&&this.nextToken()}return new pt(t,e)}},{key:"parseDefStatement",value:function(){var t=this.curToken;if(!this.expectPeek(M.FN))return null;this.nextToken();var e=this.parseIdentifier();if(null===e)return null;if(!this.expectPeek(M.LPAREN))return null;var n=null;if(this.peekTokenIs(M.IDENT)&&(this.nextToken(),n=this.parseIdentifier()),!this.expectPeek(M.RPAREN))return null;if(!this.expectPeek(M.ASSIGN))return null;this.nextToken();var i=this.parseExpression(Yt.LOWEST);return null===i?null:new kt(t,e,n,i)}},{key:"parseDimStatement",value:function(){var t=this,e=[],n=this.curToken;this.nextToken();var i=function(){var e=[],n=t.parseIdentifier();if(!n)return null;if(!t.expectPeek(M.LPAREN))return null;t.nextToken();var i=t.parseExpression(Yt.LOWEST);if(!i)return t.pushError("expecting at least one dimension"),null;for(e.push(i);t.peekTokenIs(M.COMMA);){t.nextToken(),t.nextToken();var r=t.parseExpression(Yt.LOWEST);if(!r)return t.pushError("expecting dimension after comma"),null;e.push(r)}return t.expectPeek(M.RPAREN)?{name:n,dimensions:e}:null},r=i();if(!r)return this.pushError("expecting at least one dimension variable"),null;for(e.push(r);this.peekTokenIs(M.COMMA);){this.nextToken(),this.nextToken();var s=i();s&&e.push(s)}return new dt(n,e)}},{key:"parseListStatement",value:function(){var t=this.curToken,e=null,n=null;if(this.peekTokenIs(M.INT))this.nextToken(),e=this.parseIntegerLiteral(),this.peekTokenIs(M.MINUS)?(this.nextToken(),this.peekTokenIs(M.INT)&&(this.nextToken(),n=this.parseIntegerLiteral())):n=e;else if(this.peekTokenIs(M.MINUS)){if(this.nextToken(),!this.expectPeek(M.INT))return null;n=this.parseIntegerLiteral()}return new yt(t,e,n)}},{key:"parseLoadStatement",value:function(){var t=this.curToken;this.nextToken();var e=this.parseExpression(Yt.LOWEST);return e?new gt(t,e):(this.pushError("expected filename"),null)}},{key:"parseSaveStatement",value:function(){var t=this.curToken;this.nextToken();var e=this.parseExpression(Yt.LOWEST);return e?new Et(t,e):(this.pushError("expected filename"),null)}},{key:"parseOnStatement",value:function(){var t=this.curToken;this.nextToken();var e=this.parseExpression(Yt.LOWEST);if(!e)return null;if(!this.peekTokenIs(M.GOSUB)&&!this.peekTokenIs(M.GOTO))return this.pushError("expecting gosub or goto"),null;this.nextToken();var n=this.curToken;this.nextToken();var i=[],r=this.parseExpression(Yt.LOWEST);if(!r)return this.pushError("expected at least one line number"),null;for(i.push(r);this.peekTokenIs(M.COMMA);){this.nextToken(),this.nextToken();var s=this.parseExpression(Yt.LOWEST);s&&i.push(s)}return new bt(t,e,n,i)}},{key:"parseGraphicsStatement",value:function(){var t=this.curToken;this.nextToken();var e=this.parseExpression(Yt.LOWEST);if(!e)return this.pushError("expected expression"),null;if(!this.expectPeek(M.COMMA))return null;this.nextToken();var n=this.parseExpression(Yt.LOWEST);return n?new Nt(t,e,n):(this.pushError("expected expression"),null)}},{key:"parseDrawStatement",value:function(){var t=this.curToken;this.nextToken();var e=this.parseExpression(Yt.LOWEST);if(!e)return this.pushError("expected color"),null;if(!this.expectPeek(M.COMMA))return null;this.nextToken();var n=this.parseExpression(Yt.LOWEST);if(!n)return this.pushError("expected x1"),null;if(!this.expectPeek(M.COMMA))return null;this.nextToken();var i=this.parseExpression(Yt.LOWEST);if(!i)return null;var r=null,s=null;if(this.peekTokenIs(M.TO)){if(this.nextToken(),this.nextToken(),(r=this.parseExpression(Yt.LOWEST))||this.pushError("expected x2"),!this.expectPeek(M.COMMA))return null;this.nextToken(),(s=this.parseExpression(Yt.LOWEST))||this.pushError("expected y2")}return new Ot(t,e,n,i,r,s)}},{key:"parseBoxStatement",value:function(){var t=this.curToken;this.nextToken();var e=this.parseExpression(Yt.LOWEST);if(!e)return this.pushError("expecting color"),null;if(!this.expectPeek(M.COMMA))return null;this.nextToken();var n=this.parseExpression(Yt.LOWEST);if(!n)return this.pushError("expecting left"),null;if(!this.expectPeek(M.COMMA))return null;this.nextToken();var i=this.parseExpression(Yt.LOWEST);if(!i)return this.pushError("expecting top"),null;if(!this.expectPeek(M.COMMA))return null;this.nextToken();var r=this.parseExpression(Yt.LOWEST);if(!r)return this.pushError("expecting width"),null;if(!this.expectPeek(M.COMMA))return null;this.nextToken();var s=this.parseExpression(Yt.LOWEST);return s?new Lt(t,e,n,i,r,s):(this.pushError("expecting height"),null)}}]),t}(),Kt=new Rt,Zt=1048576;function te(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return e?e.statement?new Gt("".concat(t," - (").concat(e.statement.toString()," [").concat(e.toString(),"])")):new Gt("".concat(t," - (").concat(e.toString(),")")):new Gt(t)}function ee(t){return t!==Kt&&(t.type()===H.INTEGER_OBJ||t.type()===H.FLOAT_OBJ?-1===t.value:t.type()===H.STRING_OBJ&&""!==t.value)}function ne(t,e){if(t.type===B.COMPOUND){var n=t;if(n.statements.length>0){n.next=n.statements[0];for(var i=0;i<n.statements.length-1;i++)ne(n.statements[i],n.statements[i+1]);n.statements[n.statements.length-1].next=e}}else t.next=e}!function(t){t.IDLE="IDLE",t.RUNNING="RUNNING"}(Qt||(Qt={}));var ie=function(){function t(e){G(this,t),this.globalStack=void 0,this.lines=void 0,this.state=void 0,this.api=void 0,this.forStack=void 0,this.dataStack=void 0,this.image=null,this.maxExecutionTime=void 0,this.stateChangeListeners=[],this.onStop=void 0,this.openPromises=[],this.dataStackIndex=0,this.nextStatement=void 0,this.returnStack=[],this.continueStatement=void 0,this.waitingForInput=!1,this.lastTimeout=0,this.runTime=0,this.sourceCodeMap=void 0,this.globalStack=new U,this.lines=[],this.nextStatement=null,this.state=Qt.IDLE,this.api=e,this.forStack=[],this.dataStack=[],this.continueStatement=null,this.maxExecutionTime=0,this.sourceCodeMap=new WeakMap,this.initializeGlobals()}return C(t,[{key:"ownPromise",value:function(t){return function(t,e){return new Promise((function(n,i){t.push({promise:e,cancel:function(){i("cancelled")}}),e.then((function(i){var r=t.findIndex((function(t){return t.promise===e}));t.splice(r,1),n(i)})).catch((function(n){var r=t.findIndex((function(t){return t.promise===e}));t.splice(r,1),i(n)}))}))}(this.openPromises,t)}},{key:"cancelAllPromises",value:function(){this.openPromises.forEach((function(t){return t.cancel()})),this.openPromises=[]}},{key:"initializeGlobals",value:function(){this.globalStack.set("PI",new At(Math.PI));var t=function(){return new wt(Math.round(Date.now()/.016666666666667))},e=function(){var t=new Date;return new Pt("".concat(String(t.getHours()).padStart(2,"0")).concat(String(t.getMinutes()).padStart(2,"0")).concat(String(t.getSeconds()).padStart(2,"0")))};this.globalStack.set("TIME",new Ft(t)),this.globalStack.set("TI",new Ft(t)),this.globalStack.set("TIME$",new Ft(e)),this.globalStack.set("TI$",new Ft(e))}},{key:"clr",value:function(){this.globalStack.clear(),this.forStack=[],this.returnStack=[],this.dataStack=[],this.dataStackIndex=0,this.continueStatement=null,this.image=null}},{key:"reset",value:function(){if(this.changeState(Qt.IDLE),this.clr(),this.lines.length>0){for(var t=0;t<this.lines.length-1;t++)ne(this.lines[t],this.lines[t+1]);ne(this.lines[this.lines.length-1],null)}}},{key:"runImmediateStatement",value:function(){var t=e(l().mark((function t(e){var n,i,r;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state!==Qt.RUNNING){t.next=2;break}return t.abrupt("return",te("busy"));case 2:if(""!==e.trim()){t.next=4;break}return t.abrupt("return",Kt);case 4:if(n=new qt(new zt(e.trim())),i=n.parseStatement(),!(n.errors.length>0)&&i){t.next=10;break}return(r=te("Parse error: ".concat(n.errors.join(". ")),i)).line=e,t.abrupt("return",r);case 10:if(!i.lineNumber){t.next=17;break}return this.sourceCodeMap.set(i,e.trim()),this.lines=[].concat(o(this.lines.filter((function(t){var e;return(null!==(e=t.lineNumber)&&void 0!==e?e:0)!==i.lineNumber}))),[i]).sort((function(t,e){var n,i;return(null!==(n=t.lineNumber)&&void 0!==n?n:0)<(null!==(i=e.lineNumber)&&void 0!==i?i:0)?-1:1})),this.continueStatement=null,t.abrupt("return",Kt);case 17:return ne(i,null),t.abrupt("return",this.runUntilDoneOrStopped(i));case 19:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"runStatement",value:function(){var t=e(l().mark((function t(e){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e.type,t.next=t.t0===B.EMPTY?3:t.t0===B.PRINT?4:t.t0===B.LET?5:t.t0===B.RUN?6:t.t0===B.INPUT?7:t.t0===B.COMPOUND?8:t.t0===B.GOTO?9:t.t0===B.IF?10:t.t0===B.FOR?11:t.t0===B.NEXT?12:t.t0===B.GOSUB?13:t.t0===B.RETURN?14:t.t0===B.REM?15:t.t0===B.DATA?16:t.t0===B.CLR?18:t.t0===B.READ?19:t.t0===B.RESTORE?20:t.t0===B.DEF?22:t.t0===B.DIM?23:t.t0===B.END?24:t.t0===B.CONT?25:t.t0===B.LIST?26:t.t0===B.LOAD?27:t.t0===B.SAVE?28:t.t0===B.NEW?29:t.t0===B.ON?30:t.t0===B.STOP?31:t.t0===B.GRAPHICS?32:t.t0===B.DRAW?33:t.t0===B.BOX?34:35;break;case 3:case 8:case 15:return t.abrupt("return",Kt);case 4:return t.abrupt("return",this.runPrintStatement(e));case 5:return t.abrupt("return",this.runLetStatement(e));case 6:return t.abrupt("return",this.runProgram());case 7:return t.abrupt("return",this.runInputStatement(e));case 9:return t.abrupt("return",this.goto(e.destination,e));case 10:return t.abrupt("return",this.runIfStatement(e));case 11:return t.abrupt("return",this.runForStatement(e));case 12:return t.abrupt("return",this.runNextStatement(e));case 13:return t.abrupt("return",this.runGoSubStatement(e));case 14:return t.abrupt("return",this.runReturnStatement(e));case 16:return this.preprocessDataStatement(e),t.abrupt("return",Kt);case 18:return t.abrupt("return",this.runClrStatement());case 19:return t.abrupt("return",this.runReadStatement(e));case 20:return this.dataStackIndex=0,t.abrupt("return",Kt);case 22:return t.abrupt("return",this.runDefStatement(e));case 23:return t.abrupt("return",this.runDimStatement(e));case 24:return t.abrupt("return",this.runEndStatement(e));case 25:return t.abrupt("return",this.runUntilDoneOrStopped(this.continueStatement));case 26:return t.abrupt("return",this.runListStatement(e));case 27:return t.abrupt("return",this.runLoadStatement(e));case 28:return t.abrupt("return",this.runSaveStatement(e));case 29:return t.abrupt("return",this.runNewStatement());case 30:return t.abrupt("return",this.runOnStatement(e));case 31:return t.abrupt("return",this.runStopStatement(e));case 32:return t.abrupt("return",this.runGraphicsStatement(e));case 33:return t.abrupt("return",this.runDrawStatement(e));case 34:return t.abrupt("return",this.runBoxStatement(e));case 35:return t.abrupt("return",te("invalid statement ".concat(e.type),e));case 36:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"forEachStatement",value:function(t,e){function n(i){i.type===B.COMPOUND?i.statements.forEach(n):i.type===t&&e(i)}for(var i=0;i<this.lines.length;i++)n(this.lines[i])}},{key:"prepareRunProgram",value:function(){var t=this;if(0===this.lines.length)return te("cannot run program, no program!");this.reset(),this.forEachStatement(B.DATA,(function(e){t.preprocessDataStatement(e)}))}},{key:"runUntilDoneOrStopped",value:function(){var t=e(l().mark((function t(n){var i,r,s=this;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=n,this.changeState(Qt.RUNNING),r=Kt,t.abrupt("return",new Promise(function(){var t=e(l().mark((function t(e){var n,o,a;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s.runTime=0,s.lastTimeout=Date.now(),o=function t(){var i=Date.now();s.waitingForInput||(s.runTime+=i-s.lastTimeout),s.lastTimeout=i,s.runTime>s.maxExecutionTime?(e(te("max run time exceeded")),s.changeState(Qt.IDLE)):n=setTimeout(t,250)},s.maxExecutionTime&&o(),t.prev=4;case 5:if(!i||s.state!==Qt.RUNNING){t.next=14;break}return s.nextStatement=null!==(a=i.next)&&void 0!==a?a:null,t.next=9,s.runStatement(i);case 9:(r=t.sent).type()===H.ERROR_OBJ&&e(r),i=s.nextStatement,t.next=5;break;case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(4),e(te(t.t0.message));case 19:return t.prev=19,n&&clearTimeout(n),s.changeState(Qt.IDLE),t.finish(19);case 23:e(r);case 24:case"end":return t.stop()}}),t,null,[[4,16,19,23]])})));return function(e){return t.apply(this,arguments)}}()));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"runProgram",value:function(){var t=e(l().mark((function t(){var e;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e=this.prepareRunProgram())){t.next=3;break}return t.abrupt("return",e);case 3:return t.abrupt("return",this.runUntilDoneOrStopped(this.lines[0]));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"runPrintStatement",value:function(){var t=e(l().mark((function t(e){var n,i,r=this;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.args.map((function(t){return r.evalExpression(t)})),i=0;case 2:if(!(i<n.length)){t.next=8;break}if(!Ut(n[i])){t.next=5;break}return t.abrupt("return",n[i]);case 5:i++,t.next=2;break;case 8:return t.prev=8,t.next=11,this.api.print(n.map((function(t){if(Bt(t)){var e=t.toString();return"-"!==e[0]?" ".concat(e," "):"".concat(e," ")}return t.toString()})).join(""));case 11:t.next=17;break;case 13:return t.prev=13,t.t0=t.catch(8),this.stop(),t.abrupt("return",te(t.t0.message,e));case 17:return t.abrupt("return",Kt);case 18:case"end":return t.stop()}}),t,this,[[8,13]])})));return function(e){return t.apply(this,arguments)}}()},{key:"runLetStatement",value:function(t){var e;if(!t.value)return te("let value does not exist",t);var n=this.evalExpression(t.value);if(Ut(n))return n;for(var i=(f(e={},_.INT,[H.INTEGER_OBJ,H.FLOAT_OBJ]),f(e,_.FLOAT,[H.INTEGER_OBJ,H.FLOAT_OBJ]),f(e,_.STRING,[H.STRING_OBJ]),e),r=0;r<t.names.length;r++){var s,o=t.names[r].name,a=t.names[r].indices;if((null!==(s=i[o.type])&&void 0!==s?s:[]).indexOf(n.type())<0)return te("type mismatch, ".concat(o.toString()," (").concat(o.type,") = ").concat(n.inspect()),t);var u=this.assignVarOrIndexExpression(t,o,a,n);if(Ut(u))return u}return n}},{key:"evalExpression",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t instanceof z?this.evalStringLiteral(t):t instanceof V?this.evalIntLiteral(t):t instanceof Y?this.evalFloatLiteral(t):t instanceof K?this.evalInfixExpression(t,e):t instanceof q?this.evalPrefixExpression(t,e):t instanceof X?this.evalIdentifier(t):t instanceof ht?this.evalCallExpression(t,e):t instanceof ct?t.expression?this.evalExpression(t.expression):Kt:te("unknown expression",t)}},{key:"evalStringLiteral",value:function(t){return new Pt(t.value)}},{key:"evalIntLiteral",value:function(t){return new wt(t.value)}},{key:"evalFloatLiteral",value:function(t){return new At(t.value)}},{key:"evalInfixExpression",value:function(t){var e,n,i,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=(f(i={},H.INTEGER_OBJ,(f(e={},H.INTEGER_OBJ,this.evalNumberInfix),f(e,H.FLOAT_OBJ,this.evalNumberInfix),e)),f(i,H.FLOAT_OBJ,(f(n={},H.INTEGER_OBJ,this.evalNumberInfix),f(n,H.FLOAT_OBJ,this.evalNumberInfix),n)),f(i,H.STRING_OBJ,f({},H.STRING_OBJ,this.evalStringInfix)),i);if(t.left&&t.right){var o,a=this.evalExpression(t.left,r);if(Ut(a))return a;var u=this.evalExpression(t.right,r);if(Ut(u))return u;var h=null===(o=s[a.type()])||void 0===o?void 0:o[u.type()];return h?h(a,t.operator,u,r):te("type mismatch, ".concat(a.type()," ").concat(t.operator," ").concat(u.type()),t)}return te("operator must have both a left and right side",t)}},{key:"evalNumberInfix",value:function(t,e,n,i){var r=t.value,s=n.value;switch(e){case"+":return new At(r+s);case"-":return new At(r-s);case"*":return new At(r*s);case"/":return 0===s?te("divide by zero"):new At(r/s);case"^":return new At(Math.pow(r,s));case"=":return new At(r===s?-1:0);case"<>":return new At(r!==s?-1:0);case"<":return new At(r<s?-1:0);case">":return new At(r>s?-1:0);case"<=":return new At(r<=s?-1:0);case">=":return new At(r>=s?-1:0);case"AND":return new At(i?ee(t)&&ee(n)?-1:0:r&s);case"OR":return new At(i?ee(t)||ee(n)?-1:0:r|s);case"MOD":return new At(r%s)}return te("invalid operator ".concat(e))}},{key:"evalStringInfix",value:function(t,e,n){var i=t.value,r=n.value;switch(e){case"+":return new Pt(i+r);case"=":return new At(i===r?-1:0);case"<>":return new At(i!==r?-1:0)}return new Gt("invalid operator ".concat(e))}},{key:"evalPrefixExpression",value:function(t,e){if(!t.right)return te("prefix expressions require a right hand side",t);if("FN"===t.operator){if(!(t.right instanceof ht))return te("cannot call a function on a non call expression",t);var n=this.evalExpression(t.right.fn);if(n.type()!==H.FUNCTION_OBJ)return te("cannot call a function on a non function type ".concat(n?n.type():"NULL"),t);var i=this.evalExpressions(t.right.args,!1);if(1===i.length&&Ut(i[0]))return i[0];if(i.length>1)return te("cannot call a function with more than one argument",t);if(i.length>0&&i[0].type()!==H.FLOAT_OBJ&&i[0].type()!==H.INTEGER_OBJ)return te("cannot call a function with a nun numeric argument",t);var r=new U(this.globalStack);if(n.argument){if(0===i.length)return te("expected argument for ".concat(n.argument),t);r.set(n.argument.value,i[0])}this.globalStack=r;var s=this.evalExpression(n.body,!1);return this.globalStack=r.outer,s}var o=this.evalExpression(t.right);if(Ut(o))return o;switch(o.type()){case H.INTEGER_OBJ:case H.FLOAT_OBJ:return this.evalNumberPrefix(t.operator,o,e)}return te("invalid prefix type ".concat(o.type()),t)}},{key:"evalNumberPrefix",value:function(t,e,n){switch(t){case"-":return new At(0-e.value);case"NOT":return n?ee(e)?new At(0):new At(-1):new At(~e.value)}return new Gt("invalid prefix operator ".concat(t))}},{key:"evalIdentifier",value:function(t){var e=this.globalStack.get(t.value);if(e){if(e.type()===H.CALCULATED_OBJ)return e.getValue()}else{if(jt[t.value])return jt[t.value];switch(t.type){case _.INT:return new wt(0);case _.STRING:return new Pt("");default:return new At(0)}}return e}},{key:"runInputStatement",value:function(){var t=e(l().mark((function t(e){var n,i,r,s,o;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=void 0,!e.message){t.next=7;break}if(!Ut(i=this.evalExpression(e.message))){t.next=6;break}return t.abrupt("return",i);case 6:n=i.toString();case 7:this.waitingForInput=!0,r=0;case 9:if(!(r<e.destination.length)){t.next=32;break}return t.next=12,this.ownPromise(this.api.input(n));case 12:s=t.sent,o=void 0,t.t0=e.destination[r].type,t.next=t.t0===_.STRING?17:t.t0===_.INT?19:t.t0===_.FLOAT?24:29;break;case 17:return this.globalStack.set(e.destination[r].value,new Pt(s)),t.abrupt("break",29);case 19:if(o=parseInt(s,10),!isNaN(o)){t.next=22;break}return t.abrupt("return",te("invalid integer value: ".concat(s),e));case 22:return this.globalStack.set(e.destination[r].value,new wt(o)),t.abrupt("break",29);case 24:if(o=parseFloat(s),!isNaN(o)){t.next=27;break}return t.abrupt("return",te("invalid float value: ".concat(s),e));case 27:return this.globalStack.set(e.destination[r].value,new At(o)),t.abrupt("break",29);case 29:r++,t.next=9;break;case 32:t.next=37;break;case 34:return t.prev=34,t.t1=t.catch(0),t.abrupt("return",te("error with input: ".concat(t.t1.message),e));case 37:return t.prev=37,this.waitingForInput=!1,this.runTime=0,t.finish(37);case 41:return t.abrupt("return",Kt);case 42:case"end":return t.stop()}}),t,this,[[0,34,37,41]])})));return function(e){return t.apply(this,arguments)}}()},{key:"goto",value:function(t,e){var n=this.lines.findIndex((function(e){return e.lineNumber===t}));return n<0?te("cannot goto line that does not exist, ".concat(t),e):(this.continueStatement&&this.changeState(Qt.RUNNING),this.nextStatement=this.lines[n],Kt)}},{key:"runIfStatement",value:function(){var t=e(l().mark((function t(e){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.condition){t.next=2;break}return t.abrupt("return",te("cannot run an if with no condition",e));case 2:if(!ee(this.evalExpression(e.condition,!0))){t.next=18;break}if(void 0===e.goto){t.next=8;break}return t.abrupt("return",this.goto(e.goto,e));case 8:if("number"!==typeof e.then){t.next=12;break}return t.abrupt("return",this.goto(e.then,e));case 12:if(!e.then){t.next=16;break}return ne(e.then,e.next),this.nextStatement=e.then,t.abrupt("return",Kt);case 16:t.next=23;break;case 18:if(!e.elseGoto){t.next=22;break}return t.abrupt("return",this.goto(e.elseGoto,e));case 22:e.elseThen&&(ne(e.elseThen,e.next),this.nextStatement=e.elseThen);case 23:return t.abrupt("return",Kt);case 24:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"runForStatement",value:function(){var t=e(l().mark((function t(e){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.iterator){t.next=2;break}return t.abrupt("return",te("cannot run a for loop with no iterator",e));case 2:if(e.from){t.next=4;break}return t.abrupt("return",te("cannot run a for statement with no from",e));case 4:if(!Ut(n=this.evalExpression(e.from))){t.next=7;break}return t.abrupt("return",n);case 7:return this.globalStack.set(e.iterator.value,n),this.forStack.push(e),t.abrupt("return",Kt);case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"runNextStatement",value:function(){var t=e(l().mark((function t(e){var n,i,r,s,o,a=this;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=function(t){var n,i,r=a.forStack[t];if(!r)return[!0,te("next without for",e)];var s=null!==(n=null===(i=r.iterator)||void 0===i?void 0:i.value)&&void 0!==n?n:"",o=a.globalStack.get(s);if(!o)return[!0,te("invalid variable ".concat(s),e)];if(o.type()!==H.INTEGER_OBJ&&o.type()!==H.FLOAT_OBJ)return[!0,te("cannot loop on non numeric variable",e)];var u=1;if(r.step){var h=a.evalExpression(r.step);if(Ut(h))return[!0,h];if(h.type()!==H.INTEGER_OBJ&&h.type()!==H.FLOAT_OBJ)return[!0,te("cannot step on non numeric value",e)];u=h.value}var c=a.evalNumberInfix(o,"+",new At(u),!1);if(Ut(c))return[!0,c];if(a.globalStack.set(s,c),!r.to)return[!1,te("invalid to",e)];var l=a.evalExpression(r.to);return Ut(l)?[!1,l]:ee(a.evalNumberInfix(c,u>=0?"<=":">=",l,!1))?[!0,Kt]:[!1,Kt]},i=0===e.values.length?[this.forStack.length-1]:e.values.map((function(t){return a.forStack.findIndex((function(e){var n;return(null===(n=e.iterator)||void 0===n?void 0:n.value)===t.value}))})),r=0;case 3:if(!(r<i.length)){t.next=19;break}if(!((s=i[r])<0)){t.next=7;break}return t.abrupt("return",te("cannot iterate on unknown variable",e));case 7:if(!Ut((o=n(s))[1])){t.next=10;break}return t.abrupt("return",o[1]);case 10:if(!o[0]){t.next=15;break}return this.nextStatement=this.forStack[s].next,t.abrupt("return",o[1]);case 15:!function(){var t=a.forStack[s];a.forStack=a.forStack.filter((function(e){return e!==t}))}();case 16:r++,t.next=3;break;case 19:return t.abrupt("return",Kt);case 20:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"goSub",value:function(t,e){return this.returnStack.push(t.next),this.goto(e,t)}},{key:"runGoSubStatement",value:function(){var t=e(l().mark((function t(e){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.goSub(e,e.gosubLineNumber));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"runReturnStatement",value:function(){var t=e(l().mark((function t(e){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==this.returnStack.length){t.next=2;break}return t.abrupt("return",te("cannot return on empty stack",e));case 2:return n=this.returnStack.pop(),this.nextStatement=n||null,t.abrupt("return",Kt);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"evalExpressions",value:function(t,e){for(var n=[],i=0;i<t.length;i++){var r=this.evalExpression(t[i],e);if(Ut(r))return[r];n.push(r)}return n}},{key:"evalCallExpression",value:function(t,e){var n=this.evalExpression(t.fn);if(Ut(n))return n;var i=this.evalExpressions(t.args,e);if(1===i.length&&Ut(i[0]))return i[0];if(n.type()===H.BUILTIN_OBJ)return n.fn(i);if(n.type()===H.ARRAY_OBJ){for(var r=0;r<i.length;r++)if(i[r].type()!==H.INTEGER_OBJ&&i[r].type()!==H.FLOAT_OBJ)return te("cannot use type ".concat(i[r].type()," as array access type"),t);return n.get(i.map((function(t){return t.value})))}return te("cannot call non function ".concat(n.type()),t)}},{key:"runClrStatement",value:function(){var t=e(l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.clr(),t.abrupt("return",Kt);case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"preprocessDataStatement",value:function(t){for(var e=0;e<t.datas.length;e++){var n=this.evalExpression(t.datas[e],!1);Ut(n)||this.dataStack.push(n)}}},{key:"runReadStatement",value:function(t){for(var e=0;e<t.outputs.length;e++){if(this.dataStackIndex>=this.dataStack.length)return te("no more data to read",t);var n=t.outputs[e],i=this.dataStack[this.dataStackIndex++];if(n.name.type!==_.INT&&n.name.type!==_.FLOAT||i.type()!==H.FLOAT_OBJ&&i.type()!==H.INTEGER_OBJ){if(n.name.type!==_.STRING||i.type()!==H.STRING_OBJ)return te("type mismatch. cannot set ".concat(i.type()," to identifier of type ").concat(n.name.type),t);this.assignVarOrIndexExpression(t,n.name,n.indices,i)}else n.name.type===_.FLOAT?this.assignVarOrIndexExpression(t,n.name,n.indices,new At(i.value)):n.name.type===_.INT&&this.assignVarOrIndexExpression(t,n.name,n.indices,new wt(i.value))}return Kt}},{key:"runDefStatement",value:function(t){return this.globalStack.set(t.name.value,new Ct(t.argument,t.body)),Kt}},{key:"runDimStatement",value:function(t){for(var e=0;e<t.variables.length;e++){for(var n=t.variables[e],i=[],r=0;r<n.dimensions.length;r++){var s=this.evalExpression(n.dimensions[r],!1);if(Ut(s))return s;if(s.type()===H.INTEGER_OBJ)i.push(s.value+1);else{if(s.type()!==H.FLOAT_OBJ)return te("invalid dimension type, ".concat(s.type()),t);i.push(Math.floor(s.value)+1)}}if(i.reduce((function(t,e){return t*e}),1)>=Zt)return te("dimension limit exceeded. total size cannot exceed ".concat(Zt),t);this.globalStack.set(n.name.value,new Mt(n.name.type,i))}return Kt}},{key:"runEndStatement",value:function(t){return this.continueStatement=t.next,this.changeState(Qt.IDLE),Kt}},{key:"runListStatement",value:function(){var t=e(l().mark((function t(e){var n,i,r,s,o,a,u,h,c,f,p;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=0,s=null!==(n=null===(i=this.lines[this.lines.length-1])||void 0===i?void 0:i.lineNumber)&&void 0!==n?n:0,null===e.startLine){t.next=9;break}if(!Ut(o=this.evalExpression(e.startLine))){t.next=6;break}return t.abrupt("return",o);case 6:if(o.type()===H.INTEGER_OBJ){t.next=8;break}return t.abrupt("return",te("type mismatch, expected int, got ".concat(o.type()),e));case 8:r=o.value;case 9:if(null===e.endLine){t.next=16;break}if(!Ut(a=this.evalExpression(e.endLine))){t.next=13;break}return t.abrupt("return",a);case 13:if(a.type()===H.INTEGER_OBJ){t.next=15;break}return t.abrupt("return",te("type mismatch, expected int, got ".concat(a.type()),e));case 15:s=a.value;case 16:for(u=[],h=0;h<this.lines.length;h++)(null!==(c=this.lines[h].lineNumber)&&void 0!==c?c:0)>=r&&(null!==(f=this.lines[h].lineNumber)&&void 0!==f?f:0)<=s&&(p=this.sourceCodeMap.get(this.lines[h]))&&u.push(p);return t.next=20,this.api.list(u.join("\n"));case 20:return t.abrupt("return",Kt);case 21:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"runLoadStatement",value:function(){var t=e(l().mark((function t(e){var n,i,r,s,o;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(_t(n=this.evalExpression(e.filename))){t.next=3;break}return t.abrupt("return",te("type mismatch. expecting string, received ".concat(n.type()),e));case 3:return t.next=5,this.api.load(n.value);case 5:i=t.sent,this.changeState(Qt.IDLE),this.clr(),r=i.split("\n"),s=0;case 10:if(!(s<r.length)){t.next=20;break}return t.next=13,this.runImmediateStatement(r[s]);case 13:if(!Ut(o=t.sent)){t.next=17;break}return o.line=r[s].trim(),t.abrupt("return",o);case 17:s++,t.next=10;break;case 20:return t.abrupt("return",Kt);case 21:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"runSaveStatement",value:function(){var t=e(l().mark((function t(e){var n,i=this;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(_t(n=this.evalExpression(e.filename))){t.next=3;break}return t.abrupt("return",te("type mismatch. expecting string, received ".concat(n.type()),e));case 3:return t.prev=3,t.next=6,this.api.save(n.value,this.lines.map((function(t){return i.sourceCodeMap.get(t)})).filter((function(t){return t})).join("\n"));case 6:return t.abrupt("return",Kt);case 9:return t.prev=9,t.t0=t.catch(3),console.log(t.t0),t.abrupt("return",te("string"===typeof t.t0?t.t0:t.t0.message,e));case 13:case"end":return t.stop()}}),t,this,[[3,9]])})));return function(e){return t.apply(this,arguments)}}()},{key:"runNewStatement",value:function(){return this.lines=[],this.clr(),Kt}},{key:"runOnStatement",value:function(t){var e=this.evalExpression(t.condition);if(!Bt(e))return te("expected a number type",t);var n=Math.floor(e.value)-1;if(n<0||n>=t.destinations.length)return te("undefined statement",t);var i=this.evalExpression(t.destinations[n]);return Bt(i)?t.operation.type===M.GOTO?this.goto(i.value,t):t.operation.type===M.GOSUB?this.goSub(t,i.value):Kt:te("expected a line number",t)}},{key:"runStopStatement",value:function(t){return this.continueStatement=t.next,this.stop(),Kt}},{key:"stop",value:function(){var t;null===(t=this.onStop)||void 0===t||t.call(this),this.cancelAllPromises(),this.changeState(Qt.IDLE)}},{key:"runGraphicsStatement",value:function(){var t=e(l().mark((function t(e){var n,i;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Ut(n=this.evalExpression(e.width,!1))){t.next=3;break}return t.abrupt("return",n);case 3:if(Bt(n)){t.next=5;break}return t.abrupt("return",te("expecting number, got ".concat(n.type()),e));case 5:if(!Ut(i=this.evalExpression(e.height,!1))){t.next=8;break}return t.abrupt("return",i);case 8:if(Bt(i)){t.next=10;break}return t.abrupt("return",te("expecting number, got ".concat(i.type()),e));case 10:return t.next=12,this.api.createImage(Math.floor(n.value),Math.floor(i.value));case 12:return this.image=t.sent,t.abrupt("return",Kt);case 14:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"runDrawStatement",value:function(t){if(!this.image)return te("graphics canvas not initialized",t);var e=this.evalExpression(t.color),n=this.evalExpression(t.x1),i=this.evalExpression(t.y1);if(Ut(e))return e;if(Ut(n))return n;if(Ut(i))return i;if(!_t(e))return te("expecting stringly color",t);if(!Bt(n)||!Bt(i))return te("expecting numeric x and y coordinates",t);if(t.x2&&t.y2){var r,s=this.evalExpression(t.x2),o=this.evalExpression(t.y2);if(Ut(s))return s;if(Ut(o))return o;if(!Bt(s)||!Bt(o))return te("expecting numeric x and y coordinates",t);for(var a=n.value<s.value?1:-1,u=s.value-n.value,h=o.value-i.value,c=Math.floor(n.value);c!==Math.floor(s.value);c+=a){var l,f=i.value+h*(c-n.value)/u;null===(l=this.image)||void 0===l||l.setPixel(c,f,e.value)}null===(r=this.image)||void 0===r||r.setPixel(s.value,o.value,e.value)}else{var p;null===(p=this.image)||void 0===p||p.setPixel(n.value,i.value,e.value)}return Kt}},{key:"runBoxStatement",value:function(t){var e=this.evalExpression(t.color),n=this.evalExpression(t.left),i=this.evalExpression(t.top),r=this.evalExpression(t.width),s=this.evalExpression(t.height);if(Ut(e))return e;if(!_t(e))return te("expecting stringly color value",t);if(Ut(n))return n;if(!Bt(n))return te("expecting numeric left value",t);if(Ut(i))return i;if(!Bt(i))return te("expecting numeric top value",t);if(Ut(r))return r;if(!Bt(r))return te("expecting numeric width value",t);if(Ut(s))return s;if(!Bt(s))return te("expecting numeric height value",t);if(!this.image)return te("graphics canvas not initialized",t);for(var o=n.value;o<=n.value+r.value;o++)for(var a=i.value;a<=i.value+s.value;a++){var u;null===(u=this.image)||void 0===u||u.setPixel(Math.floor(o),Math.floor(a),e.value)}return Kt}},{key:"assignVarOrIndexExpression",value:function(t,e,n,i){if(n.length>0){var r,s=this.evalExpressions(n,!1);if(1===s.length&&Ut(s[0]))return s[0];var o,a=this.globalStack.get(e.value);if(a||(this.globalStack.set(e.value,new Mt(e.type,s.map((function(t){return t.value})))),a=this.globalStack.get(e.value)),(null===(r=a)||void 0===r?void 0:r.type())!==H.ARRAY_OBJ)return te("cannot use array access on a ".concat(null===(o=a)||void 0===o?void 0:o.type()," (").concat(e.toString(),")"),t);for(var u=0;u<s.length;u++)if(s[u].type()!==H.FLOAT_OBJ&&s[u].type()!==H.INTEGER_OBJ)return te("cannot use type ".concat(s[u].type()," as array index"),t);return a.set(s.map((function(t){return t.value})),i)}return this.globalStack.set(e.value,i),i}},{key:"addStateChangeListener",value:function(t){this.stateChangeListeners.push(t)}},{key:"removeStateChangeListener",value:function(t){this.stateChangeListeners=this.stateChangeListeners.filter((function(e){return e!==t}))}},{key:"changeState",value:function(t){t!==this.state&&(this.state=t,this.stateChangeListeners.forEach((function(e){return e(t)})))}}]),t}();function re(t){return t.toString(16).padStart(2,"0")}function se(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=[],r=t;return{addListener:function(t){return i.push(t),void 0!==r&&t(r),R((function(){i=i.filter((function(e){return e!==t}))}))},publish:function(t){n?(e&&clearTimeout(e),e=setTimeout((function(){r=t,i.forEach((function(e){return e(t)}))}),n)):(r=t,i.forEach((function(e){return e(t)})))}}}var oe=[],ae=se(void 0,200),ue=se(oe,100),he=se(),ce=se(Qt.IDLE),le=se(),fe=se(),pe=se(),ve=new ie({createImage:function(t,e){var n=new ImageData(t,e);return Promise.resolve({width:t,height:e,clear:function(){n=new ImageData(t,e),ae.publish(n)},setPixel:function(e,i,r){var s=function(t){var e=0,n=0,i=0;if("#"===t[0]){var r=t.substring(1);8===r.length&&(r=r.substring(0,-2));var s=parseInt(r,16);isNaN(s)||(e=s>>16&255,n=s>>8&255,i=255&s)}else if(6===t.length||8===t.length){var o=t;8===o.length&&(o=t.substring(0,t.length-2));var a=parseInt(o,16);isNaN(a)||(e=a>>16&255,n=a>>8&255,i=255&a)}return[e,n,i]}(r),o=h(s,3),a=o[0],u=o[1],c=o[2],l=i*t*4+4*e;n.data[l+0]=a,n.data[l+1]=u,n.data[l+2]=c,n.data[l+3]=255,ae.publish(n)},getPixel:function(e,i){var r,s,o,a=i*t*4+4*e;return r=n.data[a+0],s=n.data[a+1],o=n.data[a+2],"#".concat(re(r)).concat(re(s)).concat(re(o))}})},input:function(t){return new Promise((function(e){t&&ke(t),pe.publish(R((function(t){return e(t)})))}))},list:function(t){return he.publish(t),Promise.resolve()},load:function(t){return fe.publish(t),Promise.resolve("")},print:function(t){return ke(t),Promise.resolve()},save:function(t,e){return le.publish({filename:t,code:e}),Promise.resolve()}}),ke=function(t){oe=[].concat(o(oe),[t]),ue.publish(oe)},de=function(){oe=[],ue.publish(oe)},me=function(){var t=e(l().mark((function t(e){var n,i,r,s,o;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.split("\n"),i=(new Date).valueOf(),t.next=4,ve.runImmediateStatement("NEW");case 4:ve.reset(),ve.clr(),de(),r=0;case 8:if(!(r<n.length)){t.next=14;break}return t.next=11,ve.runImmediateStatement(n[r]);case 11:r++,t.next=8;break;case 14:return t.next=16,ve.runProgram();case 16:(s=t.sent).type()===H.ERROR_OBJ&&ke(s.toString()),o=(new Date).valueOf(),console.log("run finished in ",o-i);case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Te=function(){var t=e(l().mark((function t(e){var n,i,r;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=new qt(new zt(e)),i=n.parseStatement(),!(n.errors.length>0)){t.next=6;break}n.errors.forEach(ke),t.next=15;break;case 6:if(!i){t.next=15;break}if(!i.lineNumber){t.next=11;break}ke("ERROR: ONLY IMMEDIATE STATEMENTS ARE SUPPORTED HERE."),t.next=15;break;case 11:return t.next=13,ve.runStatement(i);case 13:(r=t.sent)&&r.type()===H.ERROR_OBJ&&ke(r.message);case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();ve.addStateChangeListener((function(t){ce.publish(t)})),x({runProgram:me,runStatement:Te,stop:function(){ve.stop()},state:{addListener:ce.addListener},console:{addListener:ue.addListener,print:ke,clear:de},input:{addListener:pe.addListener},image:{addListener:ae.addListener},list:{addListener:he.addListener},save:{addListener:le.addListener},load:{addListener:fe.addListener}})}()}();
//# sourceMappingURL=worker.4e07d269.worker.js.map